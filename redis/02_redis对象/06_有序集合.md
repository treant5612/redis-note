### 有序集合

有序集合保存成员元素和它的分值并按分值排序。

有序集合的编码可以是ziplist或者skiplist。

- ziplist对象在前分值在后依次排列

  > | zlbytes | zltail | zllen | "banana" | 5.0  | "cherry" | 6.0  | zlen |

- skiplist

  skiplist的有序集合使用zset结构作为底层实现，一个zset结构包含一个字典和一个跳跃表

  > type def struct zset {
  >
  > ​	zskiplist *zsl;
  >
  > ​	dict *dict;
  >
  > } zset;

  跳跃表中每个节点都保存一个集合元素（元素+分数），而dict中则保存一个从成员到分数的映射，可以在O(1)的复杂度下查找给定集合成员的分值。

#### zset命令

 

| 命令       | ziplist                                               | zset                                                         |
| ---------- | ----------------------------------------------------- | ------------------------------------------------------------ |
| ZADD       | 调用ziplistInsert将成员和分数作为两个节点插入压缩列表 | 调用zslInsert函数将新元素加入跳跃表，再调用dictAdd将新元素关联到字典 |
| ZCARD      | 调用ziplistLen，将返回值除2得到长度                   | 访问跳跃表的length属性，直接返回长度                         |
| ZCOUNT     | 遍历压缩列表，统计在范围内的节点数量                  | 遍历跳跃表，统计分值在给定范围内的节点数量                   |
| ZRANGE     | 从表头向表尾遍历，返回给定范围内的元素                | 从表头向表尾遍历跳跃表，返回给定索引范围内的所有元素         |
| ZREVERANGE | 从表尾向表头遍历返回给定范围内的元素                  | 从表尾向表头遍历，返回给定范围内的所有元素                   |
| ZRANK      | 从表头向表尾遍历，查找给定成员，返回经过的节点数      | 从表头像表尾遍历，查找给定成员并返回经过的节点数             |
| ZREVRANK   | 从表尾向表头遍历...                                   | 从表尾向表头遍历...                                          |
| ZREM       | 遍历ziplist删除对应元素和它的分值                     | 调用dictFind查找元素，根据分值从跳跃表中删除元素，然后从字典中删除元素 |
| ZSCORE     | 遍历压缩列表，查找并返回分数                          | 从dict中取出分值并返回。                                     |

